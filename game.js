var config = {
    type: Phaser.AUTO,
    // §¯§Ñ§ã§ä§â§Ñ§Ú§Ó§Ñ§Ö§Þ §â§Ñ§Ù§Þ§Ö§â, §é§ä§à§Ò§í §à§ß §Ñ§Õ§Ñ§á§ä§Ú§â§à§Ó§Ñ§Ý§ã§ñ §Ü §ï§Ü§â§Ñ§ß§å
    scale: {
        mode: Phaser.Scale.FIT,
        autoCenter: Phaser.Scale.CENTER_BOTH,
        width: 800, // §¯§Ñ§é§Ñ§Ý§î§ß§Ñ§ñ §ê§Ú§â§Ú§ß§Ñ
        height: 600 // §¯§Ñ§é§Ñ§Ý§î§ß§Ñ§ñ §Ó§í§ã§à§ä§Ñ
    },
    physics: {
        default: 'arcade',
        arcade: {
            // debug: true // §£§Ü§Ý§ð§é§Ú§ä§Ö §Õ§Ý§ñ §à§ä§Ý§Ñ§Õ§Ü§Ú §æ§Ú§Ù§Ú§é§Ö§ã§Ü§Ú§ç §ä§Ö§Ý
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

var game = new Phaser.Game(config);
var player;
var cursors;
var map;
var layer;
const TILE_SIZE = 32;

function preload ()
{
    // §©§Ñ§Ô§â§å§Ù§Ü§Ñ §Ú§Ù§à§Ò§â§Ñ§Ø§Ö§ß§Ú§Û
    // §ª§ã§á§à§Ý§î§Ù§å§Û§ä§Ö §ã§Ó§à§Ú §Ú§Ù§à§Ò§â§Ñ§Ø§Ö§ß§Ú§ñ: 'player.png' §Õ§Ý§ñ §Ô§Ö§â§à§ñ §Ú 'tile.png' §Õ§Ý§ñ §ã§ä§Ö§ß
    this.load.image('player', 'assets/player.png'); 
    this.load.image('tiles', 'assets/tile.png'); 
}

function create ()
{
    // --- §³§à§Ù§Õ§Ñ§ß§Ú§Ö §­§Ñ§Ò§Ú§â§Ú§ß§ä§Ñ (§´§Ñ§Û§Ý§à§Ó§Ñ§ñ §¬§Ñ§â§ä§Ñ) ---
    // §¿§ä§à §à§é§Ö§ß§î §á§â§à§ã§ä§à§Û "§Ý§Ñ§Ò§Ú§â§Ú§ß§ä" (§ß§Ñ §ã§Ñ§Þ§à§Þ §Õ§Ö§Ý§Ö, §á§â§à§ã§ä§à §Ü§Ñ§â§ä§Ñ §ã §Ô§â§Ñ§ß§Ú§è§Ñ§Þ§Ú)
    // §®§Ñ§ã§ã§Ú§Ó, §á§â§Ö§Õ§ã§ä§Ñ§Ó§Ý§ñ§ð§ë§Ú§Û §ß§Ö§Ò§à§Ý§î§ê§å§ð §Ü§Ñ§â§ä§å (0 - §æ§à§ß, 1 - §ã§ä§Ö§ß§Ñ)
    const level = [
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1],
        [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1],
        [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1],
        [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1],
        [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1],
        [1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1],
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
        [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
    ];

    // §³§à§Ù§Õ§Ñ§Ö§Þ §Ü§Ñ§â§ä§å §Ú§Ù §Þ§Ñ§ã§ã§Ú§Ó§Ñ
    map = this.make.tilemap({ data: level, tileWidth: TILE_SIZE, tileHeight: TILE_SIZE });
    const tileset = map.addTilesetImage('tiles');
    layer = map.createLayer(0, tileset, 0, 0);

    // §µ§ã§ä§Ñ§ß§Ñ§Ó§Ý§Ú§Ó§Ñ§Ö§Þ §ä§Ñ§Û§Ý§í §ã §Ú§ß§Õ§Ö§Ü§ã§à§Þ 1 (§ã§ä§Ö§ß§í) §Ü§Ñ§Ü §Ü§à§Ý§Ý§Ú§Ù§Ú§ð
    map.setCollision([1]);
    
    // §µ§ã§ä§Ñ§ß§Ñ§Ó§Ý§Ú§Ó§Ñ§Ö§Þ §Ô§â§Ñ§ß§Ú§è§í §Þ§Ú§â§Ñ §á§à §â§Ñ§Ù§Þ§Ö§â§å §Ü§Ñ§â§ä§í
    this.physics.world.setBounds(0, 0, map.widthInPixels, map.heightInPixels);

    // --- §³§à§Ù§Õ§Ñ§ß§Ú§Ö §¤§Ö§â§à§ñ ---
    // §¯§Ñ§é§Ú§ß§Ñ§Ö§Þ §ã §á§à§Ù§Ú§è§Ú§Ú, §Ü§à§ä§à§â§Ñ§ñ §ß§Ö §ñ§Ó§Ý§ñ§Ö§ä§ã§ñ §ã§ä§Ö§ß§à§Û (§ß§Ñ§á§â§Ú§Þ§Ö§â, (1.5 * TILE_SIZE, 1.5 * TILE_SIZE))
    player = this.physics.add.sprite(TILE_SIZE * 1.5, TILE_SIZE * 1.5, 'player');
    player.setCollideWorldBounds(true); // §¤§Ö§â§à§Û §ß§Ö §Ó§í§ç§à§Õ§Ú§ä §Ù§Ñ §Ô§â§Ñ§ß§Ú§è§í §Þ§Ú§â§Ñ
    player.setOrigin(0.5, 0.5); 
    
    // §¥§à§Ò§Ñ§Ó§Ý§Ö§ß§Ú§Ö §Ü§à§Ý§Ý§Ú§Ù§Ú§Ú §Þ§Ö§Ø§Õ§å §Ú§Ô§â§à§Ü§à§Þ §Ú §ã§ä§Ö§ß§Ñ§Þ§Ú
    this.physics.add.collider(player, layer);

    // --- §¯§Ñ§ã§ä§â§à§Û§Ü§Ñ §¬§Ñ§Þ§Ö§â§í ---
    // §¬§Ñ§Þ§Ö§â§Ñ §Ò§å§Õ§Ö§ä §ã§Ý§Ö§Õ§à§Ó§Ñ§ä§î §Ù§Ñ §Ú§Ô§â§à§Ü§à§Þ
    this.cameras.main.startFollow(player, true, 0.1, 0.1); 
    // §°§Ô§â§Ñ§ß§Ú§é§Ú§Ó§Ñ§Ö§Þ §Ü§Ñ§Þ§Ö§â§å §Ô§â§Ñ§ß§Ú§è§Ñ§Þ§Ú §Ü§Ñ§â§ä§í
    this.cameras.main.setBounds(0, 0, map.widthInPixels, map.heightInPixels);

    // --- §µ§á§â§Ñ§Ó§Ý§Ö§ß§Ú§Ö ---
    // §³§ä§Ñ§ß§Õ§Ñ§â§ä§ß§í§Ö §Ü§å§â§ã§à§â§ß§í§Ö §Ü§Ý§Ñ§Ó§Ú§ê§Ú §Õ§Ý§ñ §±§¬
    cursors = this.input.keyboard.createCursorKeys();
    
    // **§£§¡§¨§¯§° §Õ§Ý§ñ Android:** §¥§à§Ò§Ñ§Ó§Ý§Ö§ß§Ú§Ö §ã§Ö§ß§ã§à§â§ß§à§Ô§à §å§á§â§Ñ§Ó§Ý§Ö§ß§Ú§ñ 
    // §£ §â§Ö§Ñ§Ý§î§ß§à§Û §Ú§Ô§â§Ö §Ó§Ñ§Þ §ß§å§Ø§ß§à §Õ§à§Ò§Ñ§Ó§Ú§ä§î §ß§Ñ§ï§Ü§â§Ñ§ß§ß§í§Ö §Ü§ß§à§á§Ü§Ú §Ú§Ý§Ú §Ú§ã§á§à§Ý§î§Ù§à§Ó§Ñ§ä§î §ã§Ö§ß§ã§à§â§ß§í§Û §Ó§Ó§à§Õ. 
    // §©§Õ§Ö§ã§î §Þ§í §á§â§à§ã§ä§à §Õ§à§Ò§Ñ§Ó§Ý§ñ§Ö§Þ §à§Ò§â§Ñ§Ò§à§ä§é§Ú§Ü §Õ§Ý§ñ §Õ§Ó§Ú§Ø§Ö§ß§Ú§ñ §á§â§Ú §Ü§Ñ§ã§Ñ§ß§Ú§Ú:
    this.input.on('pointerdown', function (pointer) {
        // §±§â§à§ã§ä§à§Û §á§â§Ú§Þ§Ö§â: §Õ§Ó§Ú§Ô§Ñ§ä§î§ã§ñ §Ó §ã§ä§à§â§à§ß§å §Ü§Ñ§ã§Ñ§ß§Ú§ñ
        this.physics.moveToObject(player, pointer, 200);
    }, this);
}

function update ()
{
    // §°§ä§Þ§Ö§ß§Ñ §á§â§Ö§Õ§í§Õ§å§ë§Ö§Ô§à §Õ§Ó§Ú§Ø§Ö§ß§Ú§ñ §à§ä §ã§Ö§ß§ã§à§â§ß§à§Ô§à §Ó§Ó§à§Õ§Ñ, §Ö§ã§Ý§Ú §ß§Ñ§Ø§Ñ§ä§Ñ §Ü§Ý§Ñ§Ó§Ú§ê§Ñ
    if (cursors.left.isDown || cursors.right.isDown || cursors.up.isDown || cursors.down.isDown) {
        player.body.stop();
    }
    
    const speed = 150;
    
    // §³§Ò§â§à§ã §Ô§à§â§Ú§Ù§à§ß§ä§Ñ§Ý§î§ß§à§Û §Ú §Ó§Ö§â§ä§Ú§Ü§Ñ§Ý§î§ß§à§Û §ã§Ü§à§â§à§ã§ä§Ú
    player.setVelocity(0);

    // §µ§á§â§Ñ§Ó§Ý§Ö§ß§Ú§Ö §ã §Ü§Ý§Ñ§Ó§Ú§Ñ§ä§å§â§í (§Ñ§Ü§ä§å§Ñ§Ý§î§ß§à §Õ§Ý§ñ §±§¬ §Ú§Ý§Ú §ï§Þ§å§Ý§ñ§è§Ú§Ú)
    if (cursors.left.isDown)
    {
        player.setVelocityX(-speed);
    }
    else if (cursors.right.isDown)
    {
        player.setVelocityX(speed);
    }

    if (cursors.up.isDown)
    {
        player.setVelocityY(-speed);
    }
    else if (cursors.down.isDown)
    {
        player.setVelocityY(speed);
    }

    // §¦§ã§Ý§Ú §Ú§Ô§â§à§Ü §Õ§Ó§Ú§Ô§Ñ§Ö§ä§ã§ñ §á§à §Ô§à§â§Ú§Ù§à§ß§ä§Ñ§Ý§Ú §Ú §Ó§Ö§â§ä§Ú§Ü§Ñ§Ý§Ú, §ß§à§â§Þ§Ñ§Ý§Ú§Ù§å§Ö§Þ §ã§Ü§à§â§à§ã§ä§î, 
    // §é§ä§à§Ò§í §Õ§Ó§Ú§Ø§Ö§ß§Ú§Ö §á§à §Õ§Ú§Ñ§Ô§à§ß§Ñ§Ý§Ú §ß§Ö §Ò§í§Ý§à §Ò§í§ã§ä§â§Ö§Ö.
    player.body.velocity.normalize().scale(speed);
}
